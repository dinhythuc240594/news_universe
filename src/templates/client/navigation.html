<nav class="main-nav">
    <div class="container">
        <ul class="nav-menu" id="mainMenu">
            {% if categories %}
                {% set parent_categories = categories|selectattr('parent_id', 'none')|list %}
                {% for category in parent_categories %}
                    {% set child_categories = categories|selectattr('parent_id', 'equalto', category.id)|list %}
                    <li class="{% if child_categories %}has-submenu{% endif %} {% if loop.index == 1 %}active{% endif %}" data-slug="{{ category.slug }}">
                        <a href="{{ url_for('client.category', category_slug=category.slug) }}">
                            {% if category.icon %}<i class="{{ category.icon }}"></i> {% endif %}{{ category.name }}
                        </a>
                        {% if child_categories %}
                        <ul class="submenu">
                            {% for child in child_categories %}
                            <li data-slug="{{ child.slug }}">
                                <a href="{{ url_for('client.category', category_slug=child.slug) }}">
                                    {% if child.icon %}<i class="{{ child.icon }}"></i> {% endif %}{{ child.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            {% else %}
                <!-- Fallback menu if no categories -->
                <li class="active"><a href="/"><script>document.write(MyLang.getMsg('HOME'))</script></a></li>
            {% endif %}
            <li class="more-menu-btn">
                <a href="javascript:void(0)">
                    <i class="fas fa-ellipsis-h"></i> <script>document.write(MyLang.getMsg('LOAD_MORE'))</script>
                </a>
                <ul class="more-menu-dropdown"></ul>
            </li>
        </ul>
    </div>
</nav>